<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Random Effects · MixedLRMoE.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">MixedLRMoE.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../framework/">Modelling Framework</a></li><li class="is-active"><a class="tocitem" href>Random Effects</a><ul class="internal"><li><a class="tocitem" href="#Panel-Data"><span>Panel Data</span></a></li><li><a class="tocitem" href="#Hierarchical-Data"><span>Hierarchical Data</span></a></li><li><a class="tocitem" href="#Other-Generalizations"><span>Other Generalizations</span></a></li></ul></li><li><a class="tocitem" href="../gating/">Gating Function</a></li><li><a class="tocitem" href="../fit/">Fitting Function</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Random Effects</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Random Effects</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/sparktseung/MixedLRMoE.jl/blob/main/docs/src/random_effects.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Random-Effects"><a class="docs-heading-anchor" href="#Random-Effects">Random Effects</a><a id="Random-Effects-1"></a><a class="docs-heading-anchor-permalink" href="#Random-Effects" title="Permalink"></a></h1><p>Below are two classical examples where random effects are used for modelling unobserved effects. We also illustrate how they are represented in the <strong>MixedLRMoE.jl</strong> package.</p><h2 id="Panel-Data"><a class="docs-heading-anchor" href="#Panel-Data">Panel Data</a><a id="Panel-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Panel-Data" title="Permalink"></a></h2><p>In a panel data study, suppose there are <span>$N_1$</span> unique individuals in a population of size <span>$n$</span>, where each individual may be observed multiple times.</p><ul><li>We assume the individual-level unobserved effects are <span>$\{w_1^{(l)}\}_{l = 1, 2, \dots, N_1}$</span>, where the subscript <span>$1$</span> denotes the first (and only, in this example) level of random effects and the superscript <span>$(l)$</span> indicates the <span>$l$</span>-th level, i.e. the <span>$l$</span>-th unique individual.</li><li>For each observation <span>$i$</span>, <span>$\mathbf{w}_i = (w_{i1})$</span> is a one-element vector that contains the unobserved effect of the <span>$i$</span>-th observation, where <span>$w_{i1} \in \{w_1^{(l)}\}_{l = 1, 2, \dots, N_1}$</span>.</li><li>Correspondingly, we could construct a <span>$n$</span>-length mapping vector <span>$t_1$</span> such that the <span>$i$</span>-th element maps observation <span>$i$</span> to one of the levels in <span>$\{w_1^{(l)}\}_{l = 1, 2, \dots, N_1}$</span>.</li></ul><p>Suppose we have a dataframe of the insurance claim history for the following individuals across different years, where the number of drivers <span>$N_1 = 3$</span> and the number of observations <span>$n = 10$</span>.</p><table><tr><th style="text-align: right">Observation</th><th style="text-align: right">Driver</th><th style="text-align: right">Year</th><th style="text-align: right">... (other columns)</th></tr><tr><td style="text-align: right">1</td><td style="text-align: right">Amy</td><td style="text-align: right">2015</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">Amy</td><td style="text-align: right">2016</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">Amy</td><td style="text-align: right">2017</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">4</td><td style="text-align: right">Bob</td><td style="text-align: right">2014</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">5</td><td style="text-align: right">Bob</td><td style="text-align: right">2015</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">6</td><td style="text-align: right">Bob</td><td style="text-align: right">2016</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">7</td><td style="text-align: right">Bob</td><td style="text-align: right">2017</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">8</td><td style="text-align: right">Bob</td><td style="text-align: right">2018</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">9</td><td style="text-align: right">Sam</td><td style="text-align: right">2018</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">10</td><td style="text-align: right">Sam</td><td style="text-align: right">2019</td><td style="text-align: right">...</td></tr></table><p>We represent the driver-level random effects by a set of random variables <span>$\{ w_1^{(1)}, w_1^{(2)}, w_1^{(3)} \}$</span>, for Amy, Bob and Sam respectively. For convenience (also generality, see the next example), this is represented by a vector/tuple of vectors <code>re_list = [w_1]</code> where <code>w_1 = [w_11, w_12, w_13]</code> in the package implementation.</p><p>The mapping vector is constructed as <code>t_1 = [1, 1, 1, 2, 2, 2, 2, 2, 3, 3]</code>. For convenience (also generality, see the next example), this is reshaped as a <span>$n$</span>-by-<span>$1$</span> matrix <code>mapping_matrix = hcat(t_1)</code> in the package implementation.</p><p>Correspondingly, the mapped vectors of random effects to each observation are <span>$\mathbf{w}_i = (w_1^{(1)})$</span> for <span>$i = 1, 2, 3$</span> (Amy), <span>$\mathbf{w}_i = (w_1^{(2)})$</span> for <span>$i = 4, 5, \dots, 8$</span> (Bob), and <span>$\mathbf{w}_i = (w_1^{(3)})$</span> for <span>$i = 9, 10$</span> (Sam).</p><h2 id="Hierarchical-Data"><a class="docs-heading-anchor" href="#Hierarchical-Data">Hierarchical Data</a><a id="Hierarchical-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Hierarchical-Data" title="Permalink"></a></h2><p>We consider a more complex hierarchical data structure with two levels of random effects. A classical example is the school-teacher effects on student performance (see e.g. <a href="https://www.jstor.org/stable/1170147">here</a>), whereby the teacher-level random effects are nested within the school-level random effects (assuming each teacher only works at one school). The same hierarchical data structure can be used to model many other scenarios, such as country-(province/state)-city effects on the probability of fire accidents.</p><p>Let us consider a Canadian province-city data.</p><ul><li>We assume the province-level unobserved effects are <span>$\{w_1^{(l)}\}_{l = 1, 2, \dots, N_1}$</span>, where the subscript <span>$1$</span> denotes the first level of random effects and the superscript <span>$(l)$</span> indicates the <span>$l$</span>-th level, i.e. the <span>$l$</span>-th province.</li><li>We also assume the city-level unobserved effects are <span>$\{w_2^{(l)}\}_{l = 1, 2, \dots, N_2}$</span>, where the subscript <span>$2$</span> denotes the second level of random effects and the superscript <span>$(l)$</span> indicates the <span>$l$</span>-th level, i.e. the <span>$l$</span>-th city. Note that cities are nested within provinces, i.e. each city belongs to one and only one province.</li><li>For each observation <span>$i$</span>, <span>$\mathbf{w}_i = (w_{i1}, w_{i2})$</span> is a two-element vector that contains the unobserved effects of the <span>$i$</span>-th observation, where <span>$w_{i1} \in \{w_1^{(l)}\}_{l = 1, 2, \dots, N_1}$</span> (province) and <span>$w_{i2} \in \{w_2^{(l)}\}_{l = 1, 2, \dots, N_2}$</span> (city).</li><li>Correspondingly, we could construct two <span>$n$</span>-length mapping vectors <span>$t_1$</span> and <span>$t_2$</span> to map each observation to one of the levels in <span>$\{w_1^{(l)}\}_{l = 1, 2, \dots, N_1}$</span> and <span>$\{w_2^{(l)}\}_{l = 1, 2, \dots, N_2}$</span> respectively.</li></ul><p>Suppose we have a dataframe of fire accidents history for the following cities across different provinces in Canada, where the number of provinces <span>$N_1 = 2$</span>, the number of cities <span>$N_2 = 4$</span> and the number of observations <span>$n = 10$</span>.</p><table><tr><th style="text-align: right">Observation</th><th style="text-align: right">Province</th><th style="text-align: right">City</th><th style="text-align: right">Year</th><th style="text-align: right">... (other columns)</th></tr><tr><td style="text-align: right">1</td><td style="text-align: right">Ontario</td><td style="text-align: right">Toronto</td><td style="text-align: right">2019</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">2</td><td style="text-align: right">Ontario</td><td style="text-align: right">Toronto</td><td style="text-align: right">2020</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">3</td><td style="text-align: right">Ontario</td><td style="text-align: right">Ottawa</td><td style="text-align: right">2019</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">4</td><td style="text-align: right">Ontario</td><td style="text-align: right">Ottawa</td><td style="text-align: right">2020</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">5</td><td style="text-align: right">Ontario</td><td style="text-align: right">Ottawa</td><td style="text-align: right">2021</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">6</td><td style="text-align: right">Quebec</td><td style="text-align: right">Montreal</td><td style="text-align: right">2018</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">7</td><td style="text-align: right">Quebec</td><td style="text-align: right">Montreal</td><td style="text-align: right">2019</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">8</td><td style="text-align: right">Quebec</td><td style="text-align: right">Montreal</td><td style="text-align: right">2020</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">9</td><td style="text-align: right">Quebec</td><td style="text-align: right">Quebec City</td><td style="text-align: right">2019</td><td style="text-align: right">...</td></tr><tr><td style="text-align: right">10</td><td style="text-align: right">Quebec</td><td style="text-align: right">Quebec City</td><td style="text-align: right">2020</td><td style="text-align: right">...</td></tr></table><p>We represent the province-level random effects by a set of random variables <span>$\{ w_1^{(1)}, w_1^{(2)} \}$</span>, for Ontario and Quebec respectively, and the city-level random effects by a set of random variables <span>$\{ w_2^{(1)}, w_2^{(2)}, w_2^{(3)}, w_2^{(4)}\}$</span>, for Toronto, Ottawa, Montreal and Quebec City respectively.</p><p>These random effects are represented by a vector/tuple of vectors <code>re_list = [w_1, w_2]</code> where <code>w_1 = [w_11, w_12]</code> and <code>w_2 = [w_21, w_22, w_23, w_24]</code> in the package implementation.</p><p>The mapping vectors are constructed as <code>t_1 = [1, 1, 1, 1, 1, 2, 2, 2, 2, 2]</code> and <code>t_2 = [1, 1, 2, 2, 2, 3, 3, 3, 4, 4]</code>, which are reshaped as a <span>$n$</span>-by-<span>$2$</span> matrix <code>mapping_matrix = hcat(t_1, t_2)</code> in the package implementation.</p><p>Correspondingly, the mapped vectors of random effects to each observation are <span>$\mathbf{w}_i = (w_1^{(1)}, w_2^{(1)})$</span> for <span>$i = 1, 2$</span> (Ontario-Toronto), <span>$\mathbf{w}_i = (w_1^{(1)}, w_2^{(2)})$</span> for <span>$i = 3, 4, 5$</span> (Ontario-Ottawa), <span>$\mathbf{w}_i = (w_1^{(2)}, w_2^{(3)})$</span> for <span>$i = 6, 7, 8$</span> (Quebec-Montreal), and <span>$\mathbf{w}_i = (w_1^{(2)}, w_2^{(4)})$</span> for <span>$i = 9, 10$</span> (Quebec-Quebec City).</p><h2 id="Other-Generalizations"><a class="docs-heading-anchor" href="#Other-Generalizations">Other Generalizations</a><a id="Other-Generalizations-1"></a><a class="docs-heading-anchor-permalink" href="#Other-Generalizations" title="Permalink"></a></h2><p>The above are two classical examples where random effects may be incorporated in a model. The package implementation is more general and can be applied to other scenarios, such as crossed interactions (as opposed to hierarchical), and more than two levels of random effects. In these cases, the implementations of the random effects and mapping vectors/matrix are similar to the above.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../framework/">« Modelling Framework</a><a class="docs-footer-nextpage" href="../gating/">Gating Function »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Monday 19 June 2023 09:56">Monday 19 June 2023</span>. Using Julia version 1.9.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
